@page "/chat"

<PageTitle>Chat - Vera</PageTitle>

<div class="chat-container">
    <h2>Chat with Vera AI</h2>
    
    <div class="messages-container">
        @foreach (var message in messages)
        {
            <div class="message @(message.IsUser ? "user-message" : "ai-message")">
                <div class="message-content">
                    @message.Content
                </div>
                <div class="message-time">
                    @message.Timestamp.ToString("HH:mm")
                </div>
            </div>
        }
    </div>
    
    <div class="chat-input-container">
        <input type="text" @bind="currentMessage" @bind:event="oninput" 
               @onkeypress="HandleKeyPress" 
               class="form-control" 
               placeholder="Type your message..." />
        <button @onclick="SendMessage" class="btn btn-primary">Send</button>
    </div>
</div>

@code {
    private List<ChatMessage> messages = new();
    private string currentMessage = "";
    
    private class ChatMessage
    {
        public string Content { get; set; } = "";
        public bool IsUser { get; set; }
        public DateTime Timestamp { get; set; } = DateTime.Now;
    }
    
    protected override void OnInitialized()
    {
        // Add welcome message
        messages.Add(new ChatMessage
        {
            Content = "Hi! I'm Vera, your dating assistant. I'll help you create an amazing profile. Let's start with - what do you do for a living?",
            IsUser = false
        });
    }
    
    private async Task SendMessage()
    {
        if (string.IsNullOrWhiteSpace(currentMessage)) return;
        
        messages.Add(new ChatMessage
        {
            Content = currentMessage,
            IsUser = true
        });
        
        var userMsg = currentMessage;
        currentMessage = "";
        
        // TODO: Call API to get AI response
        await Task.Delay(1000);
        
        messages.Add(new ChatMessage
        {
            Content = "That's interesting! Tell me more about your hobbies and interests.",
            IsUser = false
        });
    }
    
    private async Task HandleKeyPress(Microsoft.AspNetCore.Components.Web.KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await SendMessage();
        }
    }
}
